var nrInstancesDB,DBSize,nrInstancesStorage,multiRegionalStorage,regionalStorage,nearlineStorage,coldlineStorage,storageSize,nrInstancesVM,days,hours,calculate,service,currentCanvas,listOfCanvasses=[],idCanvas=0,memoryValues=["0GB","50GB","100GB","200GB","300GB","400GB","500GB","750GB","1TB","1,5TB","2TB","2,5TB","3TB","4TB","5TB","7,5TB","10TB","20TB","30TB","40TB","50TB","75TB","100TB","200TB","500TB","750TB"];function Canvas(){this.VirtualMachines=[],this.Databases=[],this.Storages=[],this.idCounter=0,this.numId=0,this.graphColor="rgb(255, 99, 132)",this.region="google-cloud"===service?"us":"amazon-webservices"===service?"AWS GovCloud (US)":"us-central1",this.regionTitle="google-cloud"===service?"United States":"amazon-webservices"===service?"United States":"United Statest"}function setRegion(e){currentCanvas.region=e.value,currentCanvas.regionTitle=e.selectedOptions[0].text}function setupVMSliders(){var e=document.getElementById("VMInstancesSliderID");(nrInstancesVM=document.getElementById("VMInstances")).innerHTML=e.value,e.oninput=function(){nrInstancesVM.innerHTML=this.value};var n=document.getElementById("VMDaysSliderID");(days=document.getElementById("VMDays")).innerHTML=n.value,n.oninput=function(){days.innerHTML=this.value};var t=document.getElementById("VMHoursSliderID");(hours=document.getElementById("VMHours")).innerHTML=t.value,t.oninput=function(){hours.innerHTML=this.value}}function setupStorageSliders(){var e=document.getElementById("StorageInstancesSliderID");(nrInstancesStorage=document.getElementById("StorageInstances")).innerHTML=e.value,e.oninput=function(){nrInstancesStorage.innerHTML=this.value};var n=document.getElementById("multiRegionalStorageSliderID");(multiRegionalStorage=document.getElementById("multiRegionalStorage")).innerHTML=memoryValues[0],n.oninput=function(){multiRegionalStorage.innerHTML=memoryValues[this.value]};var t=document.getElementById("regionalStorageSliderID");(regionalStorage=document.getElementById("regionalStorage")).innerHTML=memoryValues[0],t.oninput=function(){regionalStorage.innerHTML=memoryValues[this.value]};var a=document.getElementById("coldlineStorageSliderID");(coldlineStorage=document.getElementById("coldlineStorage")).innerHTML=memoryValues[0],a.oninput=function(){coldlineStorage.innerHTML=memoryValues[this.value]};var s=document.getElementById("nearlineStorageSliderID");(nearlineStorage=document.getElementById("nearlineStorage")).innerHTML=memoryValues[0],s.oninput=function(){nearlineStorage.innerHTML=memoryValues[this.value]}}function setupDBSliders(){var e=document.getElementById("DBInstancesSliderID");(nrInstancesDB=document.getElementById("DBInstances")).innerHTML=e.value,e.oninput=function(){nrInstancesDB.innerHTML=this.value};var n=document.getElementById("DBGBSliderID");(DBSize=document.getElementById("DBGB")).innerHTML=memoryValues[0],n.oninput=function(){DBSize.innerHTML=memoryValues[this.value]}}function setupWindow(){$("#myAccordion").accordion(),$(document).tooltip({track:!0}),$(document).tooltip({track:!0}),currentCanvas=new Canvas,"google-cloud"==service?(setupVMSliders(),setupStorageSliders(),setupDBSliders()):setupVMSliders();document.getElementById("exampleModal2");$("#provider").click(function(){$("#exampleModal2").show()}),$("#save-provider-modal").click(function(){$("input:checked").parent().each(function(){service=this.innerText}),$("#exampleModal2").hide(),localStorage.setItem("provider",service),location.reload()})}function loadDataFromMemory(){if(localStorage.getItem("provider")?(service=localStorage.getItem("provider"),$("#popupVMForm").load("popups.html #"+service+"VMPopup",function(){}),$("#providerForm").children("div").find("label").each(function(){this.children[0].removeAttribute("checked"),service==this.innerText&&this.children[0].setAttribute("checked",null)})):(service="google-cloud",$("#popupVMForm").load("popups.html #"+service+"VMPopup",function(){})),localStorage.getItem("curCanvas")&&"null"!=localStorage.getItem("curCanvas")){reAssignCanvas(currentCanvas=JSON.parse(localStorage.getItem("curCanvas")));for(var e=0;e<currentCanvas.VirtualMachines.length;e++){var n=currentCanvas.VirtualMachines[e];addHTML(n.nrInstances,"vm",n.numId,currentCanvas.VirtualMachines),checkIcon(currentCanvas.VirtualMachines,"vm",e)}for(e=0;e<currentCanvas.Databases.length;e++){var t=currentCanvas.Databases[e];addHTML(t.nrInstances,"db",t.numId,currentCanvas.Databases),checkIcon(currentCanvas.Databases,"db",e)}for(e=0;e<currentCanvas.Storages.length;e++){var a=currentCanvas.Storages[e];addHTML(a.nrInstances,"cs",a.numId,currentCanvas.Storages),checkIcon(currentCanvas.Storages,"cs",e)}localStorage.setItem("curCanvas",null)}if(localStorage.getItem("idCanvas")&&"null"!=localStorage.getItem("idCanvas")&&(idCanvas=localStorage.getItem("idCanvas")),JSON.parse(localStorage.getItem("listOfCanvasses"))){listOfCanvasses=JSON.parse(localStorage.getItem("listOfCanvasses"));for(e=0;e<listOfCanvasses.length;e++)reAssignCanvas(listOfCanvasses[e])}else listOfCanvasses=[];for(var e in listOfCanvasses)addCalculationToDiv(listOfCanvasses[e]),addCalculationMainGraph(listOfCanvasses[e].monthlyPrice,listOfCanvasses[e].timestamp,listOfCanvasses[e].graphColor,"graph_"+listOfCanvasses[e].numId);showCalculationDiv(),0<listOfCanvasses.length&&(document.getElementById("mainGraph").style.display="block"),isOverflown()}function reAssignCanvas(e){for(var n=0;n<e.VirtualMachines.length;n++)e.VirtualMachines[n]=Object.assign(new VirtualMachine,e.VirtualMachines[n]);for(n=0;n<e.Databases.length;n++)e.Databases[n]=Object.assign(new Database,e.Databases[n]);for(n=0;n<e.Storages.length;n++)e.Storages[n]=Object.assign(new Storage,e.Storages[n])}function isOverflown(){var e=document.getElementById("canvas-pop-up");return e.scrollHeight>e.clientHeight||e.scrollWidth>e.clientWidth?(e.style.borderTopLeftRadius="0.25rem",e.style.borderTop="1px solid rgba(0, 0, 0, 0.125)",e.style.borderBottomLeftRadius="0.25rem",e.style.borderBottom="1px solid rgba(0, 0, 0, 0.125)"):(e.style.borderTop="none",e.style.borderBottom="none"),e.scrollHeight>e.clientHeight||e.scrollWidth>e.clientWidth}function showCalculationDiv(){var e=document.getElementById("canvas-pop-up");(e.style.display="none")&&(e.style.display="block")}function buildDescriptionOfCanvas(e){return result="",result+="Virtual Machines ("+e.VirtualMachines.length+")<br />",result+="Storages ("+e.Storages.length+")<br />",result+="Databases ("+e.Databases.length+")<br />",result+="Region: "+e.regionTitle+"<br/>",result}function addCalculationToDiv(e){var n="<a  id=canvas_"+e.numId+' class="list-group-item list-group-item-action flex-column align-items-start"><div class="d-flex w-100 justify-content-between"><h5 class="mb-1">';n+='<h5 class="mb-1">'+e.service+" calculation</h5>",n+="<small>"+e.timestamp+"</small></div>",n+='<p class="mb-1">'+e.description+"</p>",n+="<small>Cost per year: $"+e.yearlyPrice+"</small>",n+='<div id="luc"><p id='+e.numId+' style="float:right" href="#" onclick="resetCanvas(id)" ><span class="glyphicon glyphicon-wrench"></span></p>',n+="<p id=graph_"+e.numId+' style="float:right;color:red" class="glyphicon glyphicon-signal" href="#" onclick="showGraph(\''+e.timestamp+"')\" > &nbsp</p>",n+="<p id="+e.numId+' style="float:right" class="glyphicon glyphicon-trash" href="#" onclick="removeCanvas('+e.numId+')"> &nbsp</p></div>',n+="<br><small>Cost per month: $"+e.monthlyPrice+"</small></a>",$("#canvas-pop-up").first().prepend(n),isOverflown()}function deleteCalc(){$("#canvas-pop-up").first().html(""),isOverflown(),clearMainGraph(),listOfCanvasses=[],localStorage.setItem("listOfCanvasses",JSON.stringify([])),localStorage.setItem("idCanvas",idCanvas),document.getElementById("mainGraph").style.display="none"}function getCloudwatchData(e){document.getElementById("calculate").disabled=!0;var n="";$.ajax({type:"POST",url:"/cloudwatch",contentType:"application/json",data:JSON.stringify({service:e}),success:function(e){n+=e}}).done(function(){pricelist=JSON.parse(n),document.getElementById("calculate").disabled=!1})}function getOfflineData(e){var n=new XMLHttpRequest;n.overrideMimeType("application/json"),n.open("GET",e+".json",!0),n.onreadystatechange=function(){if(4==n.readyState&&"200"==n.status){var e=JSON.parse(n.responseText);pricelist=e}},n.send(null)}function calculate(){var e=0,n=0;for(var t in currentCanvas.VirtualMachines)"google-cloud"==service&&(currentCanvas.VirtualMachines[t].instanceType=determineInstanceType(currentCanvas.VirtualMachines[t].type)),e+=currentCanvas.VirtualMachines[t].costMonthly(),n+=currentCanvas.VirtualMachines[t].costYear();for(var t in currentCanvas.Databases)e+=currentCanvas.Databases[t].costMonthly(),n+=currentCanvas.Databases[t].costYear();for(var t in currentCanvas.Storages)e+=currentCanvas.Storages[t].costMonthly(),n+=currentCanvas.Storages[t].costYear();currentCanvas.numId=idCanvas++,currentCanvas.service=service,currentCanvas.timestamp=(new Date).toGMTString(),currentCanvas.description=buildDescriptionOfCanvas(currentCanvas),currentCanvas.monthlyPrice=Math.round(100*e)/100,currentCanvas.yearlyPrice=Math.round(100*n)/100,listOfCanvasses.push(copyCanvas(currentCanvas)),addCalculationToDiv(currentCanvas),addCalculationMainGraph(currentCanvas.monthlyPrice,currentCanvas.timestamp,currentCanvas.graphColor,"graph_"+currentCanvas.numId),showCalculationDiv(),localStorage.setItem("idCanvas",idCanvas),localStorage.setItem("listOfCanvasses",JSON.stringify(listOfCanvasses)),document.getElementById("mainGraph").style.display="block"}function scrollFunction(){20<document.body.scrollTop||20<document.documentElement.scrollTop?document.getElementById("top").style.display="block":document.getElementById("top").style.display="none"}function topFunction(){document.body.scrollTop=0,document.documentElement.scrollTop=0}$(function(){loadDataFromMemory(),$("#myAccordion").load("accordion-"+service+".html",function(){setupWindow()}),$("#selectRegionID").load("region-"+service+".html",function(){}),getOfflineData(service),isOverflown()}),window.onscroll=function(){scrollFunction()};