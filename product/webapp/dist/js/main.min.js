var nrInstances,days,hours,storageSize,DBSize,calculate,service,listOfCanvasses=[],idCanvas=0,currentCanvas=new Canvas;function Canvas(){this.VirtualMachines=[],this.Databases=[],this.Storages=[],this.idCounter=0,this.numId=0,this.graphColor="rgb(255, 99, 132)"}function setupGoogleCloud(){var a=document.getElementById("VMInstancesSliderID");(nrInstances=document.getElementById("VMInstances")).innerHTML=a.value,a.oninput=function(){nrInstances.innerHTML=this.value};var e=document.getElementById("VMDaysSliderID");(days=document.getElementById("VMDays")).innerHTML=e.value,e.oninput=function(){days.innerHTML=this.value};var n=document.getElementById("VMHoursSliderID");(hours=document.getElementById("VMHours")).innerHTML=n.value,n.oninput=function(){hours.innerHTML=this.value};var t=document.getElementById("StorageGBSliderID");(storageSize=document.getElementById("StorageGB")).innerHTML=t.value,t.oninput=function(){storageSize.innerHTML=this.value};var s=document.getElementById("DBGBSliderID");(DBSize=document.getElementById("DBGB")).innerHTML=s.value,s.oninput=function(){DBSize.innerHTML=this.value}}function setupWindow(){$("#myAccordion").accordion(),"google-cloud"==service&&setupGoogleCloud();document.getElementById("exampleModal2");$("#provider").click(function(){$("#exampleModal2").show()}),$("#save-provider-modal").click(function(){$("input:checked").parent().each(function(){service=this.innerText}),$("#exampleModal2").hide(),localStorage.setItem("provider",service),location.reload()})}function loadDataFromMemory(){for(var a in localStorage.getItem("provider")?(service=localStorage.getItem("provider"),$("#providerForm").children("div").find("label").each(function(){this.children[0].removeAttribute("checked"),service==this.innerText&&this.children[0].setAttribute("checked",null)})):service="google-cloud",listOfCanvasses=JSON.parse(localStorage.getItem("listOfCanvasses"))?JSON.parse(localStorage.getItem("listOfCanvasses")):[])addCalculationToDiv(listOfCanvasses[a]),addCalculationMainGraph(listOfCanvasses[a].monthlyPrice,listOfCanvasses[a].timestamp,listOfCanvasses[a].graphColor,"graph_"+listOfCanvasses[a].numId);showCalculationDiv()}function showCalculationDiv(){var a=document.getElementById("canvas-pop-up");(a.style.display="none")&&(a.style.display="block")}function buildDescriptionOfCanvas(a){return result="",result+="Virtual Machines ("+a.VirtualMachines.length+")<br />",result+="Storages ("+a.Storages.length+")<br />",result+="Databases ("+a.Databases.length+")<br />",result}function addCalculationToDiv(a){var e="<a  id=canvas_"+a.numId+' class="list-group-item list-group-item-action flex-column align-items-start"><div class="d-flex w-100 justify-content-between"><h5 class="mb-1">';e+='<h5 class="mb-1">'+a.service+" calculation</h5>",e+="<small>"+a.timestamp+"</small></div>",e+='<p class="mb-1">'+a.description+"</p>",e+="<small>Cost per year: $"+a.yearlyPrice+"</small>",e+='<div id="luc"><p id='+a.numId+' style="float:right" href="#" onclick="resetCanvas(id)" ><span class="glyphicon glyphicon-wrench"></span></p>',e+="<p id=graph_"+a.numId+' style="float:right;color:red" class="glyphicon glyphicon-signal" href="#" onclick="showGraph(\''+a.timestamp+"')\" > &nbsp</p>",e+="<p id="+a.numId+' style="float:right" class="glyphicon glyphicon-trash" href="#" onclick="removeCanvas('+a.numId+')"> &nbsp</p></div>',e+="<br><small>Cost per month: $"+a.monthlyPrice+"</small></a>",$("#canvas-pop-up").first().prepend(e)}function deleteCalc(){$("#canvas-pop-up").first().html(""),clearMainGraph(),listOfCanvasses=[],localStorage.setItem("listOfCanvasses",JSON.stringify([]))}function calculate(){var t="";$.ajax({type:"POST",url:"/cloudwatch",contentType:"application/json",data:JSON.stringify({service:service}),success:function(a){t+=a}}).done(function(){t=JSON.parse(t),console.log(t.data[0].data.services);var a=0,e=0;for(var n in currentCanvas.VirtualMachines)currentCanvas.VirtualMachines[n].instanceType=determineInstanceType(currentCanvas.VirtualMachines[n].type),a+=currentCanvas.VirtualMachines[n].costMonthly(),e+=currentCanvas.VirtualMachines[n].costYear();for(var n in currentCanvas.Databases)a+=currentCanvas.Databases[n].costMonthly(),e+=currentCanvas.Databases[n].costYear();for(var n in currentCanvas.Storages)a+=currentCanvas.Storages[n].costMonthly(),e+=currentCanvas.Storages[n].costYear();currentCanvas.numId=idCanvas++,currentCanvas.service=service,currentCanvas.timestamp=(new Date).toTimeString(),currentCanvas.description="you can put a short description here",currentCanvas.monthlyPrice=Math.round(100*a)/100,currentCanvas.yearlyPrice=Math.round(100*e)/100,listOfCanvasses.push(copyCanvas(currentCanvas)),addCalculationToDiv(currentCanvas),addCalculationMainGraph(a,currentCanvas.numId,currentCanvas.graphColor,"graph_"+currentCanvas.numId),showCalculationDiv(),localStorage.setItem("listOfCanvasses",JSON.stringify(listOfCanvasses))})}function calculateTemp(){var s=new XMLHttpRequest;s.overrideMimeType("application/json"),s.open("GET","google.json",!0),s.onreadystatechange=function(){if(4==s.readyState&&"200"==s.status){var a=JSON.parse(s.responseText);if(pricelist=a.gcp_price_list,listOfCanvasses.length<5){var e=0,n=0;for(var t in currentCanvas.VirtualMachines)currentCanvas.VirtualMachines[t].instanceType=determineInstanceType(currentCanvas.VirtualMachines[t].type),e+=currentCanvas.VirtualMachines[t].costMonthly(),n+=currentCanvas.VirtualMachines[t].costYear();for(var t in currentCanvas.Databases)e+=currentCanvas.Databases[t].costMonthly(),n+=currentCanvas.Databases[t].costYear();for(var t in currentCanvas.Storages)e+=currentCanvas.Storages[t].costMonthly(),n+=currentCanvas.Storages[t].costYear();currentCanvas.numId=idCanvas++,currentCanvas.service=service,currentCanvas.timestamp=(new Date).toGMTString(),currentCanvas.description=buildDescriptionOfCanvas(currentCanvas),currentCanvas.monthlyPrice=Math.round(100*e)/100,currentCanvas.yearlyPrice=Math.round(100*n)/100,listOfCanvasses.push(copyCanvas(currentCanvas)),addCalculationToDiv(currentCanvas),addCalculationMainGraph(currentCanvas.monthlyPrice,currentCanvas.timestamp,currentCanvas.graphColor,"graph_"+currentCanvas.numId),showCalculationDiv(),localStorage.setItem("listOfCanvasses",JSON.stringify(listOfCanvasses))}}},s.send(null)}function scrollFunction(){20<document.body.scrollTop||20<document.documentElement.scrollTop?document.getElementById("top").style.display="block":document.getElementById("top").style.display="none"}function topFunction(){document.body.scrollTop=0,document.documentElement.scrollTop=0}$(function(){loadDataFromMemory(),$("#myAccordion").load("accordion-"+service+".html",function(){setupWindow()}),calculate()}),window.onscroll=function(){scrollFunction()};