function newObjectExists(e,a){for(var n=Object.getOwnPropertyNames(e),t=0;t<a.length;t++){var r=!1,s=Object.getOwnPropertyNames(a[t]);n.length!=s.length&&(r=!0);for(var c=0;t<n.length;c++){var i=n[c];if("nrInstances"==i)break;if(e[i]!==a[t][i]&&(r=!0),r)break}if(!r)return a[t].numId}return-1}function createBasicVirtualMachine(e,a,n){var t=new VirtualMachine;return t.nrInstances=e,t.days=a,t.hours=n,t.instanceType=determineInstanceType(t.type),t.region=currentCanvas.region,t}function createBasicDatabase(e,a){var n=new Database;return n.dataSize=a,n.nrInstances=e,n.region=currentCanvas.region,n}function createBasicStorage(e,a,n,t,r){var s=new Storage;return s.multiRegional=a,s.regional=n,s.nearline=t,s.coldline=r,s.nrInstances=e,s.region=currentCanvas.region,s}function addVirtualMachine(e){var a=newObjectExists(e,currentCanvas.VirtualMachines);if(-1!=a){var n=getObjectById(a,currentCanvas.VirtualMachines);incrementNrInstances(n,e.nrInstances,currentCanvas.VirtualMachines),changeHTML(n,currentCanvas.VirtualMachines,"vm",a),checkIcon(currentCanvas.VirtualMachines,"vm",n)}else e.numId=currentCanvas.idCounter++,currentCanvas.VirtualMachines.push(e),addHTML(e.nrInstances,"vm",e.numId,currentCanvas.VirtualMachines),checkIcon(currentCanvas.VirtualMachines,"vm",currentCanvas.VirtualMachines.length-1),openPopup(e)}function addDatabase(e){var a=newObjectExists(e,currentCanvas.Databases);if(-1!=a){var n=getObjectById(a,currentCanvas.Databases);incrementNrInstances(n,e.nrInstances,currentCanvas.Databases),changeHTML(n,currentCanvas.Databases,"db",a),checkIcon(currentCanvas.Databases,"db",n)}else e.numId=currentCanvas.idCounter++,currentCanvas.Databases.push(e),addHTML(e.nrInstances,"db",e.numId,currentCanvas.Databases),checkIcon(currentCanvas.Databases,"db",currentCanvas.Databases.length-1)}function addStorage(e){var a=newObjectExists(e,currentCanvas.Storages);if(-1!=a){var n=getObjectById(a,currentCanvas.Storages);incrementNrInstances(n,e.nrInstances,currentCanvas.Storages),changeHTML(n,currentCanvas.Storages,"cs",a),checkIcon(currentCanvas.Storages,"cs",n)}else e.numId=currentCanvas.idCounter++,currentCanvas.Storages.push(e),addHTML(e.nrInstances,"cs",e.numId,currentCanvas.Storages),checkIcon(currentCanvas.Storages,"cs",currentCanvas.Storages.length-1)}function getObjectById(e,a){for(var n=0;n<a.length;n++)if(a[n].numId==e)return n;return console.error("Shouldn't reach here!"),null}function resetCanvas(e){clearBox("itemsvm","itemsst","itemsdb"),currentCanvas=copyCanvas(listOfCanvasses[getObjectById(e,listOfCanvasses)]);for(var a=0;a<currentCanvas.VirtualMachines.length;a++){var n=currentCanvas.VirtualMachines[a];addHTML(n.nrInstances,"vm",n.numId,currentCanvas.VirtualMachines),checkIcon(currentCanvas.VirtualMachines,"vm",a)}for(a=0;a<currentCanvas.Databases.length;a++){var t=currentCanvas.Databases[a];addHTML(t.nrInstances,"db",t.numId,currentCanvas.Databases),checkIcon(currentCanvas.Databases,"db",a)}for(a=0;a<currentCanvas.Storages.length;a++){var r=currentCanvas.Storages[a];addHTML(r.nrInstances,"cs",r.numId,currentCanvas.Storages),checkIcon(currentCanvas.Storages,"cs",a)}service=currentCanvas.service,localStorage.setItem("provider",service)}function removeCanvas(e,a){$("#canvas_"+e).remove(),removeCalculationMainGraph(listOfCanvasses[getObjectById(e,listOfCanvasses)].timestamp),listOfCanvasses.splice(getObjectById(e,listOfCanvasses),1),localStorage.setItem("listOfCanvasses",JSON.stringify(listOfCanvasses)),0==listOfCanvasses.length&&(document.getElementById("mainGraph").style.display="none")}function attachVariable(e,a){var n=document.getElementById(e);if("type"===e)for(var t=Object.keys(pricelist.data[0].data.services),r=0;r<t.length;r++){var s=t[r].replace("CP-COMPUTEENGINE-VMIMAGE-","");if(t[r]!==s&&null==t[r].match("PREEMPTIBLE"))(c=document.createElement("option")).text=s+" vCPUs: "+pricelist.data[0].data.services["CP-COMPUTEENGINE-VMIMAGE-"+s].properties.cores+" RAM: "+pricelist.data[0].data.services["CP-COMPUTEENGINE-VMIMAGE-"+s].properties.memory+" GB",c.value=s,n.add(c)}else if("GPUType"===e){var c;(c=document.createElement("option")).text=c.value="NVIDIA_TESLA_K80",n.add(c),(c=document.createElement("option")).text=c.value="NVIDIA_TESLA_P100",n.add(c)}null!=n&&(n.value=a[e],n.onchange=function(){a[e]="nrInstances"===e?parseInt(this.value):this.value,"type"===e&&(a.instanceType=determineInstanceType(a.type),"shared"===pricelist.data[0].data.services["CP-COMPUTEENGINE-VMIMAGE-"+n.value].properties.cores?(a.committedUsage="0",document.getElementById("committedUsage").disabled=!0,document.getElementById("committedUsage").value="0"):document.getElementById("committedUsage").disabled=!1),a instanceof VirtualMachine?updatePopupGraphVM(a):a instanceof Storage?updatePopupGraphCS(a):a instanceof Database?updatePopupGraphDB(a):console.error("instance of object on the canvas is not right")})}function openPopup(e){for(var a in e)e.hasOwnProperty(a)&&attachVariable(a,e)}function addHTML(e,a,n,t){var r="<div id='"+a+"_"+n+"' class='icons'><img src='images/"+a+".png'><p>"+e+"</p> <a href='#' onclick='removeIcon(\""+a+'", "'+n+'", "'+t+"\");'><span class='glyphicon glyphicon-trash'></span></a><a href='#' data-toggle='modal' data-target='#"+a+"Settings'\tonclick='showSettings(\""+a+'", '+n+");'> <span class='glyphicon glyphicon-wrench'></span> </a></div>";"vm"===a?$("#itemsvm").append(r):"db"===a?$("#itemsdb").append(r):$("#itemsst").append(r)}function changeHTML(e,a,n,t){var r=a[e];$("#"+n+"_"+t+" p").text(r.nrInstances)}function changeImage(e,a,n,t){var r=e+"_"+t;document.getElementById(r).getElementsByTagName("img")[0].src=n}function checkIcon(e,a,n){1<e[n].nrInstances?changeImage(a,n,"images/multiple"+a+".png",e[n].numId):changeImage(a,n,"images/"+a+".png",e[n].numId)}function incrementNrInstances(e,a,n){var t=n[e];t.nrInstances=t.nrInstances+a}function allowDrop(e){e.preventDefault()}function dragDatabase(e){jQuery.event.props.push("dataTransfer");var a=createBasicDatabase(parseInt(nrInstancesDB.innerHTML),parseInt(DBSize.innerHTML)),n=JSON.stringify(a);e.dataTransfer.setData("foo",n)}function dragStorage(e){jQuery.event.props.push("dataTransfer");var a=createBasicStorage(parseInt(nrInstancesStorage.innerHTML),parseInt(multiRegionalStorage.innerHTML),parseInt(regionalStorage.innerHTML),parseInt(nearlineStorage.innerHTML),parseInt(coldlineStorage.innerHTML)),n=JSON.stringify(a);e.dataTransfer.setData("foo",n)}function dragVM(e){jQuery.event.props.push("dataTransfer");var a=createBasicVirtualMachine(parseInt(nrInstancesVM.innerHTML),parseInt(days.innerHTML),parseInt(hours.innerHTML)),n=JSON.stringify(a);e.dataTransfer.setData("foo",n)}function drop(e){e.preventDefault();var a=JSON.parse(e.dataTransfer.getData("foo"));"VirtualMachine"===a.objectName&&addVirtualMachine(Object.assign(new VirtualMachine,a));"Database"===a.objectName&&addDatabase(Object.assign(new Database,a));"Storage"===a.objectName&&addStorage(Object.assign(new Storage,a))}function refresh(){for(var e in clearBox("itemsvm"),currentCanvas.VirtualMachines){currentCanvas.VirtualMachines[e];$("#itemsvm").append($('<div class="test" ></div>').html('<img src="images/VM.png">'))}}function clearBox(e,a,n){document.getElementById(e).innerHTML="",document.getElementById(a).innerHTML="",document.getElementById(n).innerHTML="",currentCanvas=new Canvas}function removeIcon(e,a){$("#"+e+"_"+a).remove(),"vm"!=e?"db"!=e?"cs"!=e?console.error("Error removing icon"):currentCanvas.Storages.splice(getObjectById(a,currentCanvas.Storages),1):currentCanvas.Databases.splice(getObjectById(a,currentCanvas.Databases),1):currentCanvas.VirtualMachines.splice(getObjectById(a,currentCanvas.VirtualMachines),1)}function copyCanvas(e){for(var a=[],n=[],t=[],r=new Canvas,s=0;s<e.VirtualMachines.length;s++)a.push(Object.assign(new VirtualMachine,e.VirtualMachines[s]));for(s=0;s<e.Databases.length;s++)n.push(Object.assign(new Database,e.Databases[s]));for(s=0;s<e.Storages.length;s++)t.push(Object.assign(new Storage,e.Storages[s]));return r.idCounter=e.idCounter,r.numId=e.numId,r.service=e.service,r.timestamp=e.timestamp,r.description=e.description,r.monthlyPrice=e.monthlyPrice,r.yearlyPrice=e.yearlyPrice,r.VirtualMachines=a,r.Databases=n,r.Storages=t,r}function showSettings(e,a){var n,t,r;return"vm"==e?(r=getObjectById(a,currentCanvas.VirtualMachines),n=currentCanvas.VirtualMachines[r],openPopup(t=Object.assign(new VirtualMachine,n)),$("#vmSettings").find("#save-modal").click(function(){currentCanvas.VirtualMachines[r]=t,changeHTML(r,currentCanvas.VirtualMachines,e,a),checkIcon(currentCanvas.VirtualMachines,e,r)}),t.instanceType=determineInstanceType(t.type),void updatePopupGraphVM(t)):"db"==e?(r=getObjectById(a,currentCanvas.Databases),n=currentCanvas.Databases[r],openPopup(t=Object.assign(new Database,n)),$("#dbSettings").find("#save-modal").click(function(){currentCanvas.Databases[r]=t,changeHTML(r,currentCanvas.Databases,e,a),checkIcon(currentCanvas.Databases,e,r)}),t.instanceType=determineInstanceType(t.type),void updatePopupGraphDB(t)):"cs"==e?(r=getObjectById(a,currentCanvas.Storages),n=currentCanvas.Storages[r],openPopup(t=Object.assign(new Storage,n)),$("#csSettings").find("#save-modal").click(function(){currentCanvas.Storages[r]=t,changeHTML(r,currentCanvas.Storages,e,a),checkIcon(currentCanvas.Storages,e,r)}),t.instanceType=determineInstanceType(t.type),void updatePopupGraphCS(t)):void console.error("Error showing settings, not allowed to reach here")}