function newObjectExists(a,e){for(var n=Object.getOwnPropertyNames(a),t=0;t<e.length;t++){var r=!1,s=Object.getOwnPropertyNames(e[t]);n.length!=s.length&&(r=!0);for(var c=0;t<n.length;c++){var i=n[c];if("nrInstances"==i)break;if(a[i]!==e[t][i]&&(r=!0),r)break}if(!r)return e[t].numId}return-1}function createBasicVirtualMachine(a,e,n){var t=new VirtualMachine;return t.nrInstances=a,t.days=e,t.hours=n,t.instanceType=determineInstanceType(t.type),t}function createBasicDatabase(a,e){var n=new Database;return n.dataSize=e,n.nrInstances=a,n}function createBasicStorage(a,e){var n=new Storage;return n.multiRegional=e,n.nrInstances=a,n}function addVirtualMachine(a){var e=newObjectExists(a,currentCanvas.VirtualMachines);if(-1!=e){var n=getObjectById(e,currentCanvas.VirtualMachines);incrementNrInstances(n,a.nrInstances,currentCanvas.VirtualMachines),changeHTML(n,currentCanvas.VirtualMachines,"vm",e),checkIcon(currentCanvas.VirtualMachines,"vm",n)}else a.numId=currentCanvas.idCounter++,currentCanvas.VirtualMachines.push(a),addHTML(a.nrInstances,"vm",a.numId,currentCanvas.VirtualMachines),checkIcon(currentCanvas.VirtualMachines,"vm",currentCanvas.VirtualMachines.length-1),openPopup(a)}function addDatabase(a){var e=newObjectExists(a,currentCanvas.Databases);if(-1!=e){var n=getObjectById(e,currentCanvas.Databases);incrementNrInstances(n,a.nrInstances,currentCanvas.Databases),changeHTML(n,currentCanvas.Databases,"db",e),checkIcon(currentCanvas.Databases,"db",n)}else a.numId=currentCanvas.idCounter++,currentCanvas.Databases.push(a),addHTML(a.nrInstances,"db",a.numId,currentCanvas.Databases),checkIcon(currentCanvas.Databases,"db",currentCanvas.Databases.length-1)}function addStorage(a){var e=newObjectExists(a,currentCanvas.Storages);if(-1!=e){var n=getObjectById(e,currentCanvas.Storages);incrementNrInstances(n,a.nrInstances,currentCanvas.Storages),changeHTML(n,currentCanvas.Storages,"cs",e),checkIcon(currentCanvas.Storages,"cs",n)}else a.numId=currentCanvas.idCounter++,currentCanvas.Storages.push(a),addHTML(a.nrInstances,"cs",a.numId,currentCanvas.Storages),checkIcon(currentCanvas.Storages,"cs",currentCanvas.Storages.length-1)}function getObjectById(a,e){for(var n=0;n<e.length;n++)if(e[n].numId==a)return n;return console.error("Shouldn't reach here!"),null}function resetCanvas(a){clearBox("itemsvm","itemsst","itemsdb"),currentCanvas=copyCanvas(listOfCanvasses[getObjectById(a,listOfCanvasses)]);for(var e=0;e<currentCanvas.VirtualMachines.length;e++){var n=currentCanvas.VirtualMachines[e];addHTML(n.nrInstances,"vm",n.numId,currentCanvas.VirtualMachines),checkIcon(currentCanvas.VirtualMachines,"vm",e)}for(e=0;e<currentCanvas.Databases.length;e++){var t=currentCanvas.Databases[e];addHTML(t.nrInstances,"db",t.numId,currentCanvas.Databases),checkIcon(currentCanvas.Databases,"db",e)}for(e=0;e<currentCanvas.Storages.length;e++){var r=currentCanvas.Storages[e];addHTML(r.nrInstances,"cs",r.numId,currentCanvas.Storages),checkIcon(currentCanvas.Storages,"cs",e)}service=currentCanvas.service,localStorage.setItem("provider",service)}function removeCanvas(a,e){$("#canvas_"+a).remove(),removeCalculationMainGraph(listOfCanvasses[getObjectById(a,listOfCanvasses)].timestamp),listOfCanvasses.splice(getObjectById(a,listOfCanvasses),1),localStorage.setItem("listOfCanvasses",JSON.stringify(listOfCanvasses)),console.log(listOfCanvasses.length),0==listOfCanvasses.length&&(document.getElementById("mainGraph").style.display="none")}function attachVariable(a,e){var n=document.getElementById(a);if("type"===a)for(var t=Object.keys(pricelist),r=0;r<t.length;r++){var s=t[r].replace("CP-COMPUTEENGINE-VMIMAGE-","");if(t[r]!==s&&null==t[r].match("PREEMPTIBLE"))(c=document.createElement("option")).text=s+" vCPUs: "+pricelist["CP-COMPUTEENGINE-VMIMAGE-"+s].cores+" RAM: "+pricelist["CP-COMPUTEENGINE-VMIMAGE-"+s].memory,c.value=s,n.add(c)}else if("GPUType"===a){var c;(c=document.createElement("option")).text=c.value="NVIDIA_TESLA_K80",n.add(c),(c=document.createElement("option")).text=c.value="NVIDIA_TESLA_P100",n.add(c)}null!=n&&(n.value=e[a],n.onchange=function(){e[a]=parseInt(this.value),e.instanceType=determineInstanceType(e.type),e instanceof VirtualMachine?updatePopupGraphVM(e):e instanceof Storage?updatePopupGraphCS(e):e instanceof Database?updatePopupGraphDB(e):console.error("instance of object on the canvas is not right")})}function openPopup(a){for(var e in a)a.hasOwnProperty(e)&&attachVariable(e,a)}function addHTML(a,e,n,t){var r="<div id='"+e+"_"+n+"' class='icons'><img src='images/"+e+".png'><p>"+a+"</p> <a href='#' onclick='removeIcon(\""+e+'", "'+n+'", "'+t+"\");'><span class='glyphicon glyphicon-trash'></span></a><a href='#' data-toggle='modal' data-target='#"+e+"Settings'\tonclick='showSettings(\""+e+'", '+n+");'> <span class='glyphicon glyphicon-wrench'></span> </a></div>";"vm"===e?$("#itemsvm").append(r):"db"===e?$("#itemsdb").append(r):$("#itemsst").append(r)}function changeHTML(a,e,n,t){var r=e[a];$("#"+n+"_"+t+" p").text(r.nrInstances)}function changeImage(a,e,n,t){var r=a+"_"+t;document.getElementById(r).getElementsByTagName("img")[0].src=n}function checkIcon(a,e,n){1<a[n].nrInstances?changeImage(e,n,"images/multiple"+e+".png",a[n].numId):changeImage(e,n,"images/"+e+".png",a[n].numId)}function incrementNrInstances(a,e,n){var t=n[a];t.nrInstances=t.nrInstances+e}function allowDrop(a){a.preventDefault()}function dragDatabase(a){jQuery.event.props.push("dataTransfer");var e=createBasicDatabase(parseInt(nrInstancesDB.innerHTML),parseInt(DBSize.innerHTML)),n=JSON.stringify(e);a.dataTransfer.setData("foo",n)}function dragStorage(a){jQuery.event.props.push("dataTransfer");var e=createBasicStorage(parseInt(nrInstancesStorage.innerHTML),parseInt(storageSize.innerHTML)),n=JSON.stringify(e);a.dataTransfer.setData("foo",n)}function dragVM(a){jQuery.event.props.push("dataTransfer");var e=createBasicVirtualMachine(parseInt(nrInstancesVM.innerHTML),parseInt(days.innerHTML),parseInt(hours.innerHTML)),n=JSON.stringify(e);a.dataTransfer.setData("foo",n)}function drop(a){a.preventDefault();var e=JSON.parse(a.dataTransfer.getData("foo"));"VirtualMachine"===e.objectName&&addVirtualMachine(Object.assign(new VirtualMachine,e));"Database"===e.objectName&&addDatabase(Object.assign(new Database,e));"Storage"===e.objectName&&addStorage(Object.assign(new Storage,e))}function refresh(){for(var a in clearBox("itemsvm"),currentCanvas.VirtualMachines){currentCanvas.VirtualMachines[a];$("#itemsvm").append($('<div class="test" ></div>').html('<img src="images/VM.png">'))}}function clearBox(a,e,n){document.getElementById(a).innerHTML="",document.getElementById(e).innerHTML="",document.getElementById(n).innerHTML="",currentCanvas=new Canvas}function removeIcon(a,e){$("#"+a+"_"+e).remove(),"vm"!=a?"db"!=a?"cs"!=a?console.error("Error removing icon"):currentCanvas.Storages.splice(getObjectById(e,currentCanvas.Storages),1):currentCanvas.Databases.splice(getObjectById(e,currentCanvas.Databases),1):currentCanvas.VirtualMachines.splice(getObjectById(e,currentCanvas.VirtualMachines),1)}function copyCanvas(a){for(var e=[],n=[],t=[],r=new Canvas,s=0;s<a.VirtualMachines.length;s++)e.push(Object.assign(new VirtualMachine,a.VirtualMachines[s]));for(s=0;s<a.Databases.length;s++)n.push(Object.assign(new Database,a.Databases[s]));for(s=0;s<a.Storages.length;s++)t.push(Object.assign(new Storage,a.Storages[s]));return r.idCounter=a.idCounter,r.numId=a.numId,r.service=a.service,r.timestamp=a.timestamp,r.description=a.description,r.monthlyPrice=a.monthlyPrice,r.yearlyPrice=a.yearlyPrice,r.VirtualMachines=e,r.Databases=n,r.Storages=t,r}function showSettings(a,e){var n,t,r;return"vm"==a?(r=getObjectById(e,currentCanvas.VirtualMachines),n=currentCanvas.VirtualMachines[r],openPopup(t=Object.assign(new VirtualMachine,n)),$("#vmSettings").find("#save-modal").click(function(){currentCanvas.VirtualMachines[r]=t,changeHTML(r,currentCanvas.VirtualMachines,a,e),checkIcon(currentCanvas.VirtualMachines,a,r)}),t.instanceType=determineInstanceType(t.type),void updatePopupGraphVM(t)):"db"==a?(r=getObjectById(e,currentCanvas.Databases),n=currentCanvas.Databases[r],openPopup(t=Object.assign(new Database,n)),$("#dbSettings").find("#save-modal").click(function(){currentCanvas.Databases[r]=t,changeHTML(r,currentCanvas.Databases,a,e),checkIcon(currentCanvas.Databases,a,r)}),t.instanceType=determineInstanceType(t.type),void updatePopupGraphDB(t)):"cs"==a?(r=getObjectById(e,currentCanvas.Storages),n=currentCanvas.Storages[r],openPopup(t=Object.assign(new Storage,n)),$("#csSettings").find("#save-modal").click(function(){currentCanvas.Storages[r]=t,changeHTML(r,currentCanvas.Storages,a,e),checkIcon(currentCanvas.Storages,a,r)}),t.instanceType=determineInstanceType(t.type),void updatePopupGraphCS(t)):void console.error("Error showing settings, not allowed to reach here")}