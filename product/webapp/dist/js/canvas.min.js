var memorySize=[0,50,100,200,300,400,500,750,1e3,1500,2e3,2500,3e3,4e3,5e3,7500,1e4,2e4,3e4,4e4,5e4,75e3,1e5,2e5,5e5,75e4];function newObjectExists(e,a){for(var n=Object.getOwnPropertyNames(e),t=0;t<a.length;t++){var s=!1,r=Object.getOwnPropertyNames(a[t]);n.length!=r.length&&(s=!0);for(var c=0;t<n.length;c++){var i=n[c];if("nrInstances"==i)break;if(e[i]!==a[t][i]&&(s=!0),s)break}if(!s)return a[t].numId}return-1}function createBasicVirtualMachine(e,a,n){var t=new VirtualMachine;return t.nrInstances=e,t.days=a,t.hours=n,"google-cloud"==service&&(t.instanceType=determineInstanceType(t.type)),t}function createBasicDatabase(e,a){var n=new Database;return n.dataSize=a,n.nrInstances=e,n}function createBasicStorage(e,a,n,t,s){var r=new Storage;return r.multiRegional=a,r.regional=n,r.nearline=t,r.coldline=s,r.nrInstances=e,r}function addVirtualMachine(e){var a=newObjectExists(e,currentCanvas.VirtualMachines);if(-1!=a){var n=getObjectById(a,currentCanvas.VirtualMachines);incrementNrInstances(n,e.nrInstances,currentCanvas.VirtualMachines),changeHTML(n,currentCanvas.VirtualMachines,"vm",a),checkIcon(currentCanvas.VirtualMachines,"vm",n)}else e.numId=currentCanvas.idCounter++,currentCanvas.VirtualMachines.push(e),addHTML(e.nrInstances,"vm",e.numId,currentCanvas.VirtualMachines),checkIcon(currentCanvas.VirtualMachines,"vm",currentCanvas.VirtualMachines.length-1)}function addDatabase(e){var a=newObjectExists(e,currentCanvas.Databases);if(-1!=a){var n=getObjectById(a,currentCanvas.Databases);incrementNrInstances(n,e.nrInstances,currentCanvas.Databases),changeHTML(n,currentCanvas.Databases,"db",a),checkIcon(currentCanvas.Databases,"db",n)}else e.numId=currentCanvas.idCounter++,currentCanvas.Databases.push(e),addHTML(e.nrInstances,"db",e.numId,currentCanvas.Databases),checkIcon(currentCanvas.Databases,"db",currentCanvas.Databases.length-1)}function addStorage(e){var a=newObjectExists(e,currentCanvas.Storages);if(-1!=a){var n=getObjectById(a,currentCanvas.Storages);incrementNrInstances(n,e.nrInstances,currentCanvas.Storages),changeHTML(n,currentCanvas.Storages,"cs",a),checkIcon(currentCanvas.Storages,"cs",n)}else e.numId=currentCanvas.idCounter++,currentCanvas.Storages.push(e),addHTML(e.nrInstances,"cs",e.numId,currentCanvas.Storages),checkIcon(currentCanvas.Storages,"cs",currentCanvas.Storages.length-1)}function getObjectById(e,a){for(var n=0;n<a.length;n++)if(a[n].numId==e)return n;return console.error("Shouldn't reach here!"),null}function resetCanvas(e){clearBox("itemsvm","itemsst","itemsdb"),currentCanvas=copyCanvas(listOfCanvasses[getObjectById(e,listOfCanvasses)]),service!=currentCanvas.service?(service=currentCanvas.service,localStorage.setItem("curCanvas",JSON.stringify(currentCanvas)),localStorage.setItem("provider",service),location.reload()):document.getElementById("selectRegionID").value=currentCanvas.region;for(var a=0;a<currentCanvas.VirtualMachines.length;a++){var n=currentCanvas.VirtualMachines[a];addHTML(n.nrInstances,"vm",n.numId,currentCanvas.VirtualMachines),checkIcon(currentCanvas.VirtualMachines,"vm",a)}for(a=0;a<currentCanvas.Databases.length;a++){var t=currentCanvas.Databases[a];addHTML(t.nrInstances,"db",t.numId,currentCanvas.Databases),checkIcon(currentCanvas.Databases,"db",a)}for(a=0;a<currentCanvas.Storages.length;a++){var s=currentCanvas.Storages[a];addHTML(s.nrInstances,"cs",s.numId,currentCanvas.Storages),checkIcon(currentCanvas.Storages,"cs",a)}document.getElementById("selectRegionID").value=currentCanvas.region,disableRegions()}function removeCanvas(e,a){$("#canvas_"+e).remove(),removeCalculationMainGraph(listOfCanvasses[getObjectById(e,listOfCanvasses)].timestamp),listOfCanvasses.splice(getObjectById(e,listOfCanvasses),1),localStorage.setItem("listOfCanvasses",JSON.stringify(listOfCanvasses)),0==listOfCanvasses.length&&(document.getElementById("mainGraph").style.display="none"),isOverflown()}function attachVariable(e,a){var n;if(n="nrInstances"===e?"VirtualMachine"===a.objectName?document.getElementById(e):"Storage"===a.objectName?document.getElementById(e+"Storage"):document.getElementById(e+"DB"):document.getElementById(e),"type"===e&&0===n.options.length){var t=Object.getOwnPropertyNames(pricelist.data[0].data.services);switch(service){case"google-cloud":for(var s=0;s<t.length;s++){var r=t[s].replace("CP-COMPUTEENGINE-VMIMAGE-","");if(t[s]!==r&&null===t[s].match("PREEMPTIBLE"))(c=document.createElement("option")).text=r+" vCPUs: "+pricelist.data[0].data.services["CP-COMPUTEENGINE-VMIMAGE-"+r].properties.cores+" RAM: "+pricelist.data[0].data.services["CP-COMPUTEENGINE-VMIMAGE-"+r].properties.memory+" GB",c.value=r,n.add(c)}break;case"microsoft-azure":for(s=0;s<t.length;s++){r=t[s].replace(" SQL Server Web","");if(0!=Object.getOwnPropertyNames(pricelist.data[0].data.services[t[s]]).length)(c=document.createElement("option")).text=r,c.value=r,n.add(c)}break;case"amazon-webservices":for(s=0;s<t.length;s++){var c;r=t[s].replace("-Linux","");if(t[s]!==r)(c=document.createElement("option")).text=r+" vCPUs: "+pricelist.data[0].data.services[r+"-"+a.osType].properties.vCPU+" RAM: "+pricelist.data[0].data.services[r+"-"+a.osType].properties["Memory (GiB)"]+" GB",c.value=r,n.add(c)}}}a instanceof VirtualMachine?initPopupGraphVM(a):a instanceof Storage?initPopupGraphCS(a):a instanceof Database?initPopupGraphDB(a):console.error("instance of object on the canvas is not right"),null!=n&&(n.value=a[e],n.onchange=function(){"type"===e||"osType"===e||"GPUType"===e||"committedUsage"===e?a[e]=this.value:"preemptible"===e?a[e]="true"===this.value:"days"==e?7<parseInt(this.value)?(a[e]=7,this.value=7):parseInt(this.value)<1?(a[e]=1,this.value=1):a[e]=parseInt(this.value):"hours"==e?24<parseInt(this.value)?(a[e]=24,this.value=24):parseInt(this.value)<1?(a[e]=1,this.value=1):a[e]=parseInt(this.value):a[e]=parseInt(this.value),"type"===e&&"google-cloud"===service&&(a.instanceType=determineInstanceType(a.type),"shared"===pricelist.data[0].data.services["CP-COMPUTEENGINE-VMIMAGE-"+n.value].properties.cores?(a.committedUsage="0",document.getElementById("committedUsage").disabled=!0,document.getElementById("committedUsage").value="0"):document.getElementById("committedUsage").disabled=!1),a instanceof VirtualMachine?updatePopupGraphVM(a):a instanceof Storage?updatePopupGraphCS(a):a instanceof Database?updatePopupGraphDB(a):console.error("instance of object on the canvas is not right"),disableInvalid(a)})}function disableInvalid(e){for(var a in console.log("disabling invalid objects"),e)if(e.hasOwnProperty(a)&&(list=document.getElementById(a),null!=list&&"SELECT"===list.nodeName)){prev=e[a];for(var n=list.options.length-1;0<=n;n--){e[a]=list.options[n].value;try{if(isNaN(e.costMonthly()))throw"invalid";list.options[n].disabled=!1}catch(e){list.options[n].disabled=!0}}e[a]=prev}}function disableRegions(){list=document.getElementById("selectRegionID"),console.log(list),prev=currentCanvas.region;for(var a=list.options.length-1;0<=a;a--){currentCanvas.region=list.options[a].value;try{if(isNaN(simpleCalc()))throw"invalid";list.options[a].disabled=!1}catch(e){list.options[a].disabled=!0}}currentCanvas.region=prev}function simpleCalc(){var e=0;for(var a in currentCanvas.VirtualMachines)"google-cloud"==service&&(currentCanvas.VirtualMachines[a].instanceType=determineInstanceType(currentCanvas.VirtualMachines[a].type)),e+=currentCanvas.VirtualMachines[a].costMonthly(),currentCanvas.VirtualMachines[a].costYear();for(var a in currentCanvas.Databases)e+=currentCanvas.Databases[a].costMonthly(),currentCanvas.Databases[a].costYear();for(var a in currentCanvas.Storages)e+=currentCanvas.Storages[a].costMonthly(),currentCanvas.Storages[a].costYear();return console.log(e),e}function openPopup(e){for(var a in e)e.hasOwnProperty(a)&&attachVariable(a,e);disableInvalid(e)}function addHTML(e,a,n,t){var s="<div id='"+a+"_"+n+"' class='icons'><img src='images/"+a+".png'><p>"+e+"</p> <a href='#' onclick='removeIcon(\""+a+'", "'+n+'", "'+t+"\");'><span class='glyphicon glyphicon-trash'></span></a><a href='#' data-toggle='modal' data-target='#"+a+"Settings'\tonclick='showSettings(\""+a+'", '+n+");'> <span class='glyphicon glyphicon-wrench'></span> </a></div>";"vm"===a?$("#itemsvm").append(s):"db"===a?$("#itemsdb").append(s):$("#itemsst").append(s)}function changeHTML(e,a,n,t){var s=a[e];$("#"+n+"_"+t+" p").text(s.nrInstances)}function changeImage(e,a,n,t){var s=e+"_"+t;document.getElementById(s).getElementsByTagName("img")[0].src=n}function checkIcon(e,a,n){1<e[n].nrInstances?changeImage(a,n,"images/multiple"+a+".png",e[n].numId):changeImage(a,n,"images/"+a+".png",e[n].numId)}function incrementNrInstances(e,a,n){var t=n[e];t.nrInstances=t.nrInstances+a}function allowDrop(e){e.preventDefault()}function dragDatabase(e){jQuery.event.props.push("dataTransfer");var a=document.getElementById("DBGBSliderID"),n=createBasicDatabase(parseInt(nrInstancesDB.innerHTML),memorySize[a.value]),t=JSON.stringify(n);e.dataTransfer.setData("foo",t)}function dragStorage(e){jQuery.event.props.push("dataTransfer");var a=document.getElementById("multiRegionalStorageSliderID"),n=document.getElementById("regionalStorageSliderID"),t=document.getElementById("nearlineStorageSliderID"),s=document.getElementById("coldlineStorageSliderID"),r=createBasicStorage(parseInt(nrInstancesStorage.innerHTML),memorySize[a.value],memorySize[n.value],memorySize[t.value],memorySize[s.value]),c=JSON.stringify(r);e.dataTransfer.setData("foo",c)}function dragVM(e){jQuery.event.props.push("dataTransfer");var a=createBasicVirtualMachine(parseInt(nrInstancesVM.innerHTML),parseInt(days.innerHTML),parseInt(hours.innerHTML)),n=JSON.stringify(a);e.dataTransfer.setData("foo",n)}function drop(e){e.preventDefault();var a=JSON.parse(e.dataTransfer.getData("foo"));"VirtualMachine"===a.objectName&&addVirtualMachine(Object.assign(new VirtualMachine,a));"Database"===a.objectName&&addDatabase(Object.assign(new Database,a));"Storage"===a.objectName&&addStorage(Object.assign(new Storage,a))}function refresh(){for(var e in clearBox("itemsvm"),currentCanvas.VirtualMachines){currentCanvas.VirtualMachines[e];$("#itemsvm").append($('<div class="test" ></div>').html('<img src="images/VM.png">'))}}function clearBox(e,a,n){document.getElementById(e).innerHTML="",document.getElementById(a).innerHTML="",document.getElementById(n).innerHTML="",currentCanvas=new Canvas,disableRegions()}function removeIcon(e,a){var n;return $("#"+e+"_"+a).remove(),"vm"==e?(n=getObjectById(a,currentCanvas.VirtualMachines),currentCanvas.VirtualMachines.splice(n,1),void disableRegions()):"db"==e?(n=getObjectById(a,currentCanvas.Databases),currentCanvas.Databases.splice(n,1),void disableRegions()):"cs"==e?(n=getObjectById(a,currentCanvas.Storages),currentCanvas.Storages.splice(n,1),void disableRegions()):void console.error("Error removing icon")}function copyCanvas(e){for(var a=[],n=[],t=[],s=new Canvas,r=0;r<e.VirtualMachines.length;r++)a.push(Object.assign(new VirtualMachine,e.VirtualMachines[r]));for(r=0;r<e.Databases.length;r++)n.push(Object.assign(new Database,e.Databases[r]));for(r=0;r<e.Storages.length;r++)t.push(Object.assign(new Storage,e.Storages[r]));return s.idCounter=e.idCounter,s.numId=e.numId,s.service=e.service,s.timestamp=e.timestamp,s.description=e.description,s.monthlyPrice=e.monthlyPrice,s.yearlyPrice=e.yearlyPrice,s.VirtualMachines=a,s.Databases=n,s.Storages=t,s.region=e.region,s.regionTitle=e.regionTitle,s}function showSettings(n,t){var e,s,r;return"vm"==n?(r=getObjectById(t,currentCanvas.VirtualMachines),e=currentCanvas.VirtualMachines[r],openPopup(s=Object.assign(new VirtualMachine,e)),$("#vmSettings").find("#save-modal").unbind("click"),$("#vmSettings").find("#save-modal").click(function(){var e=newObjectExists(s,currentCanvas.VirtualMachines);if(console.log(currentCanvas.VirtualMachines),-1!=e&&e!=t){console.log("dit");var a=getObjectById(e,currentCanvas.VirtualMachines);incrementNrInstances(a,s.nrInstances,currentCanvas.VirtualMachines),changeHTML(a,currentCanvas.VirtualMachines,"vm",e),checkIcon(currentCanvas.VirtualMachines,"vm",a),removeIcon("vm",t)}else currentCanvas.VirtualMachines[r]=s,changeHTML(r,currentCanvas.VirtualMachines,n,t),checkIcon(currentCanvas.VirtualMachines,n,r),disableRegions()}),"google-cloud"==service&&(s.instanceType=determineInstanceType(s.type)),void updatePopupGraphVM(s)):"db"==n?(r=getObjectById(t,currentCanvas.Databases),e=currentCanvas.Databases[r],openPopup(s=Object.assign(new Database,e)),$("#dbSettings").find("#save-modal").unbind("click"),$("#dbSettings").find("#save-modal").click(function(){var e=newObjectExists(s,currentCanvas.Databases);if(-1!=e&&e!=t){console.log("dit");var a=getObjectById(e,currentCanvas.Databases);incrementNrInstances(a,s.nrInstances,currentCanvas.Databases),changeHTML(a,currentCanvas.Databases,"db",e),checkIcon(currentCanvas.Databases,"db",a),removeIcon("db",t)}else currentCanvas.Databases[r]=s,changeHTML(r,currentCanvas.Databases,n,t),checkIcon(currentCanvas.Databases,n,r)}),void updatePopupGraphDB(s)):"cs"==n?(r=getObjectById(t,currentCanvas.Storages),e=currentCanvas.Storages[r],openPopup(s=Object.assign(new Storage,e)),$("#csSettings").find("#save-modal").unbind("click"),$("#csSettings").find("#save-modal").click(function(){var e=newObjectExists(s,currentCanvas.Storages);if(-1!=e&&e!=t){console.log("dit");var a=getObjectById(e,currentCanvas.Storages);incrementNrInstances(a,s.nrInstances,currentCanvas.Storages),changeHTML(a,currentCanvas.Storages,"cs",e),checkIcon(currentCanvas.Storages,"cs",a),removeIcon("cs",t)}else currentCanvas.Storages[r]=s,changeHTML(r,currentCanvas.Storages,n,t),checkIcon(currentCanvas.Storages,n,r)}),void updatePopupGraphCS(s)):void console.error("Error showing settings, not allowed to reach here")}