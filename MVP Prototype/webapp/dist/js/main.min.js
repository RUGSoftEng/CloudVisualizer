var nrInstances,days,hours,storageSize,DBSize,calculate,service="google-cloud";function Canvas(){this.VirtualMachines=[],this.Databases=[],this.Storages=[],this.idCounter=0,this.numId=0}var listOfCanvasses=[],idCanvas=0,currentCanvas=new Canvas;function newObjectExists(e,n){for(var a=Object.getOwnPropertyNames(e),t=0;t<n.length;t++){var s=!1,r=Object.getOwnPropertyNames(n[t]);a.length!=r.length&&(s=!0);for(var c=0;t<a.length;c++){var o=a[c];if("nrInstances"==o)break;if(e[o]!==n[t][o]&&(s=!0),s)break}if(!s)return n[t].numId}return-1}function createBasicVirtualMachine(e,n,a){var t=new VirtualMachine;return t.nrInstances=e,t.days=n,t.hours=a,t.instanceType=determineInstanceType(t.type),t}function createBasicDatabase(e){var n=new Database;return n.dataSize=e,n}function createBasicStorage(e){var n=new Storage;return n.multiRegional=e,n}function addVirtualMachine(e){var n=newObjectExists(e,currentCanvas.VirtualMachines);if(-1!=n){var a=getObjectById(n,currentCanvas.VirtualMachines);console.log("EXISTS"),incrementNrInstances(a,e.nrInstances,currentCanvas.VirtualMachines),changeHTML(a,currentCanvas.VirtualMachines,"vm",n),checkIcon(currentCanvas.VirtualMachines,"vm",a)}else console.log("New virtual machine!"),e.numId=currentCanvas.idCounter++,currentCanvas.VirtualMachines.push(e),addHTML(e.nrInstances,"vm",e.numId,currentCanvas.VirtualMachines),checkIcon(currentCanvas.VirtualMachines,"vm",currentCanvas.VirtualMachines.length-1),openPopup(e)}function addDatabase(e){var n=newObjectExists(e,currentCanvas.Databases);if(-1!=n){var a=getObjectById(n,currentCanvas.Databases);console.log("EXISTS"),incrementNrInstances(a,e.nrInstances,currentCanvas.Databases),changeHTML(a,currentCanvas.Databases,"db",n),checkIcon(currentCanvas.Databases,"db",a)}else console.log("New data base!"),e.numId=currentCanvas.idCounter++,currentCanvas.Databases.push(e),addHTML(e.nrInstances,"db",e.numId,currentCanvas.Databases),checkIcon(currentCanvas.Databases,"db",currentCanvas.Databases.length-1)}function addStorage(e){var n=newObjectExists(e,currentCanvas.Storages);if(-1!=n){var a=getObjectById(n,currentCanvas.Storages);console.log("EXISTS"),incrementNrInstances(a,e.nrInstances,currentCanvas.Storages),changeHTML(a,currentCanvas.Storages,"cs",n),checkIcon(currentCanvas.Storages,"cs",a)}else console.log("New storage!"),e.numId=currentCanvas.idCounter++,currentCanvas.Storages.push(e),addHTML(e.nrInstances,"cs",e.numId,currentCanvas.Storages),checkIcon(currentCanvas.Storages,"cs",currentCanvas.Storages.length-1)}function getObjectById(e,n){for(var a=0;a<n.length;a++)if(n[a].numId==e)return a;return console.log("Shouldn't reach here!"),null}function resetCanvas(e){clearBox("itemsvm","itemsst","itemsdb"),currentCanvas=copyCanvas(listOfCanvasses[getObjectById(e,listOfCanvasses)]);for(var n=0;n<currentCanvas.VirtualMachines.length;n++){var a=currentCanvas.VirtualMachines[n];addHTML(a.nrInstances,"vm",a.numId,currentCanvas.VirtualMachines),checkIcon(currentCanvas.VirtualMachines,"vm",n)}for(n=0;n<currentCanvas.Databases.length;n++){var t=currentCanvas.Databases[n];addHTML(t.nrInstances,"db",t.numId,currentCanvas.Databases),checkIcon(currentCanvas.Databases,"db",n)}for(n=0;n<currentCanvas.Storages.length;n++){var s=currentCanvas.Storages[n];addHTML(s.nrInstances,"cs",s.numId,currentCanvas.Storages),checkIcon(currentCanvas.Storages,"cs",n)}}function removeCanvas(e,n){$("#canvas_"+e).remove(),listOfCanvasses.splice(getObjectById(e,listOfCanvasses),1)}function attachVariable(e,n){var a=document.getElementById(e);if("type"===e)for(var t=Object.keys(pricelist),s=0;s<t.length;s++){var r=t[s].replace("CP-COMPUTEENGINE-VMIMAGE-","");if(t[s]!==r&&null==t[s].match("PREEMPTIBLE"))(c=document.createElement("option")).text=r+" vCPUs: "+pricelist["CP-COMPUTEENGINE-VMIMAGE-"+r].cores+" RAM: "+pricelist["CP-COMPUTEENGINE-VMIMAGE-"+r].memory,c.value=r,a.add(c)}else if("GPUType"===e){var c;(c=document.createElement("option")).text=c.value="NVIDIA_TESLA_K80",a.add(c),(c=document.createElement("option")).text=c.value="NVIDIA_TESLA_P100",a.add(c)}null!=a&&(a.value=n[e],a.onchange=function(){n[e]=this.value})}function openPopup(e){for(var n in e)e.hasOwnProperty(n)&&attachVariable(n,e)}function addHTML(e,n,a,t){var s="<div id='"+n+"_"+a+"' class='icons'><img src='images/"+n+".png'><p>"+e+"</p> <a href='#' onclick='removeIcon(\""+n+'", "'+a+'", "'+t+"\");'><span class='glyphicon glyphicon-trash'></span></a><a href='#' data-toggle='modal' data-target='#"+n+"Settings'\tonclick='showSettings(\""+n+'", '+a+");'> <span class='glyphicon glyphicon-wrench'></span> </a></div>";"vm"===n?$("#itemsvm").append(s):"db"===n?$("#itemsdb").append(s):$("#itemsst").append(s)}function changeHTML(e,n,a,t){var s=n[e];$("#"+a+"_"+t+" p").text(s.nrInstances)}function changeImage(e,n,a,t){var s=e+"_"+t;document.getElementById(s).getElementsByTagName("img")[0].src=a}function checkIcon(e,n,a){1<e[a].nrInstances&&changeImage(n,a,"images/multiple"+n+".png",e[a].numId)}function incrementNrInstances(e,n,a){var t=a[e];t.nrInstances=t.nrInstances+n}function allowDrop(e){e.preventDefault()}function dragDatabase(e){jQuery.event.props.push("dataTransfer");var n=createBasicDatabase(parseInt(DBSize.innerHTML)),a=JSON.stringify(n);e.dataTransfer.setData("foo",a)}function dragStorage(e){jQuery.event.props.push("dataTransfer");var n=createBasicStorage(parseInt(storageSize.innerHTML)),a=JSON.stringify(n);e.dataTransfer.setData("foo",a)}function dragVM(e){jQuery.event.props.push("dataTransfer");var n=createBasicVirtualMachine(parseInt(nrInstances.innerHTML),parseInt(days.innerHTML),parseInt(hours.innerHTML)),a=JSON.stringify(n);e.dataTransfer.setData("foo",a)}function drop(e){e.preventDefault();var n=JSON.parse(e.dataTransfer.getData("foo"));"VirtualMachine"===n.objectName&&addVirtualMachine(Object.assign(new VirtualMachine,n));"Database"===n.objectName&&addDatabase(Object.assign(new Database,n));"Storage"===n.objectName&&addStorage(Object.assign(new Storage,n))}function refresh(){for(var e in clearBox("itemsvm"),currentCanvas.VirtualMachines){currentCanvas.VirtualMachines[e];$("#itemsvm").append($('<div class="test" ></div>').html('<img src="images/VM.png">')),console.log(e.hours)}}function clearBox(e,n,a){document.getElementById(e).innerHTML="",document.getElementById(n).innerHTML="",document.getElementById(a).innerHTML="",currentCanvas=new Canvas}function removeIcon(e,n){$("#"+e+"_"+n).remove(),"vm"!=e?"db"!=e?"cs"!=e?console.log("NO THANKS"):currentCanvas.Storages.splice(getObjectById(n,currentCanvas.Storages),1):currentCanvas.Databases.splice(getObjectById(n,currentCanvas.Databases),1):currentCanvas.VirtualMachines.splice(getObjectById(n,currentCanvas.VirtualMachines),1)}function showCalculationDiv(){var e=document.getElementById("canvas-pop-up");(e.style.display="none")&&(e.style.display="block")}function addCalculationToDiv(e,n,a,t){var s=new Date,r="<a  id=canvas_"+n+' class="list-group-item list-group-item-action flex-column align-items-start"><div class="d-flex w-100 justify-content-between"><h5 class="mb-1">';r+='<h5 class="mb-1">Calculation for '+service+"</h5>",r+="<small>"+s.toTimeString()+"</small></div>",r+='<p class="mb-1">'+e+"</p>",r+="<small>Cost per year: $"+a+"</small>",r+="<p id="+n+' style="float:right" class="glyphicon glyphicon-share-alt" href="#" onclick="resetCanvas(id)" > &nbsp</p>',r+='<p style="float:right" class="glyphicon glyphicon-signal" href="#" onclick="" > &nbsp</p>',r+="<p id="+n+' style="float:right" class="glyphicon glyphicon-trash" href="#" onclick="removeCanvas(id)"> &nbsp</p>',r+="<br><small>Cost per month: $"+t+"</small></a>";document.getElementById("canvas-pop-up").children[0].innerHTML+=r}function calculate(){console.log("Querying cloudwatch for data from "+service);var n="";$.ajax({type:"POST",url:"/cloudwatch",contentType:"application/json",data:JSON.stringify({service:service}),success:function(e){n+=e}}).done(function(){console.log("Finished processing response of AJAX request to cloudwatch "),console.log(JSON.stringify("/google.json"));addCalculationToDiv(n.substring(0,300),Math.round(0)/100),showCaculationDiv()})}function copyCanvas(e){for(var n=[],a=[],t=[],s=new Canvas,r=0;r<e.VirtualMachines.length;r++)n.push(Object.assign(new VirtualMachine,e.VirtualMachines[r]));for(r=0;r<e.Databases.length;r++)a.push(Object.assign(new Database,e.Databases[r]));for(r=0;r<e.Storages.length;r++)t.push(Object.assign(new Storage,e.Storages[r]));return s.idCounter=e.idCounter,s.numId=e.numId,s.VirtualMachines=n,s.Databases=a,s.Storages=t,s}function calculateTemp(){var s=new XMLHttpRequest;s.overrideMimeType("application/json"),s.open("GET","google.json",!0),s.onreadystatechange=function(){if(4==s.readyState&&"200"==s.status){var e=JSON.parse(s.responseText);if(pricelist=e.gcp_price_list,listOfCanvasses.length<5){currentCanvas.numId=idCanvas++,listOfCanvasses.push(copyCanvas(currentCanvas));var n=0,a=0;for(var t in currentCanvas.VirtualMachines)currentCanvas.VirtualMachines[t].instanceType=determineInstanceType(currentCanvas.VirtualMachines[t].type),console.log(currentCanvas.VirtualMachines[t].costMonthly()),n+=currentCanvas.VirtualMachines[t].costMonthly(),a+=currentCanvas.VirtualMachines[t].costYear();for(var t in currentCanvas.Databases)console.log("Monthly costs: "+currentCanvas.Databases[t].costMonthly()),n+=currentCanvas.Databases[t].costMonthly(),a+=currentCanvas.Databases[t].costYear();for(var t in currentCanvas.Storages)console.log("Monthly costs: "+currentCanvas.Storages[t].costMonthly()),n+=currentCanvas.Storages[t].costMonthly(),a+=currentCanvas.Storages[t].costYear();addCalculationToDiv("".substring(0,300),currentCanvas.numId,Math.round(100*a)/100,Math.round(100*n)/100),showCalculationDiv()}}},s.send(null)}function scrollFunction(){20<document.body.scrollTop||20<document.documentElement.scrollTop?document.getElementById("top").style.display="block":document.getElementById("top").style.display="none"}function topFunction(){document.body.scrollTop=0,document.documentElement.scrollTop=0}function showSettings(e,n){"vm"!=e?"db"!=e?"cs"!=e?console.log("no reach here bitte"):openPopup(currentCanvas.Storages[getObjectById(n,currentCanvas.Storages)]):openPopup(currentCanvas.Databases[getObjectById(n,currentCanvas.Databases)]):openPopup(currentCanvas.VirtualMachines[getObjectById(n,currentCanvas.VirtualMachines)])}function closeSettings(e){document.getElementById(e).style.display="none"}$(function(){$("#myAccordion").accordion();var e=document.getElementById("VMInstancesSliderID");(nrInstances=document.getElementById("VMInstances")).innerHTML=e.value,e.oninput=function(){nrInstances.innerHTML=this.value};var n=document.getElementById("VMDaysSliderID");(days=document.getElementById("VMDays")).innerHTML=n.value,n.oninput=function(){days.innerHTML=this.value};var a=document.getElementById("VMHoursSliderID");(hours=document.getElementById("VMHours")).innerHTML=a.value,a.oninput=function(){hours.innerHTML=this.value};var t=document.getElementById("StorageGBSliderID");(storageSize=document.getElementById("StorageGB")).innerHTML=t.value,t.oninput=function(){storageSize.innerHTML=this.value};var s=document.getElementById("DBGBSliderID");(DBSize=document.getElementById("DBGB")).innerHTML=s.value,s.oninput=function(){DBSize.innerHTML=this.value};var r=document.getElementById("myModal"),c=document.getElementById("provider"),o=document.getElementById("save-modal"),i=document.getElementsByClassName("close")[0];c.onclick=function(){r.style.display="block"},o.onclick=function(){$("input:checked").parent().each(function(){service=this.innerText}),r.style.display="none"},i.onclick=function(){r.style.display="none"},window.onclick=function(e){e.target==r&&($("input:checked").parent().each(function(){service=this.innerText}),r.style.display="none")}}),window.onscroll=function(){scrollFunction()};