var nrInstances,days,hours,storageSize,DBSize,calculate,service="google-cloud",VirtualMachines=[],Databases=[],Storages=[],idCounter=0;function newObjectExists(e,n){for(var t=Object.getOwnPropertyNames(e),a=0;a<n.length;a++){var s=!1,o=Object.getOwnPropertyNames(n[a]);t.length!=o.length&&(s=!0);for(var c=0;a<t.length;c++){var i=t[c];if("nrInstances"==i)break;if(e[i]!==n[a][i]&&(s=!0),s)break}if(!s)return n[a].numId}return-1}function createBasicVirtualMachine(e,n,t){var a=new VirtualMachine;return a.nrInstances=e,a.days=n,a.hours=t,a.instanceType=determineInstanceType(a.type),a}function createBasicDatabase(e){var n=new Database;return n.dataSize=e,n}function createBasicStorage(e){var n=new Storage;return n.multiRegional=e,n}function addVirtualMachine(e){var n=newObjectExists(e,VirtualMachines);if(-1!=n){var t=getObjectById(n,VirtualMachines);console.log("EXISTS"),incrementNrInstances(t,e.nrInstances,VirtualMachines),changeHTML(t,VirtualMachines,"vm",n),checkIcon(VirtualMachines,"vm",t)}else console.log("New virtual machine!"),e.numId=idCounter++,VirtualMachines.push(e),addHTML(VirtualMachines.length-1,e.nrInstances,"vm",e.numId,VirtualMachines),checkIcon(VirtualMachines,"vm",VirtualMachines.length-1),openPopup(e)}function addDatabase(e){var n=newObjectExists(e,Databases);if(-1!=n){var t=getObjectById(n,Databases);console.log("EXISTS"),incrementNrInstances(t,e.nrInstances,Databases),changeHTML(t,Databases,"db",n),checkIcon(Databases,"db",t)}else console.log("New data base!"),e.numId=idCounter++,Databases.push(e),addHTML(Databases.length-1,e.nrInstances,"db",e.numId,Databases),checkIcon(Databases,"db",Databases.length-1)}function addStorage(e){var n=newObjectExists(e,Storages);if(-1!=n){var t=getObjectById(n,Storages);console.log("EXISTS"),incrementNrInstances(t,e.nrInstances,Storages),changeHTML(t,Storages,"cs",n),checkIcon(Storages,"cs",t)}else console.log("New storage!"),e.numId=idCounter++,Storages.push(e),addHTML(Storages.length-1,e.nrInstances,"cs",e.numId,Storages),checkIcon(Storages,"cs",Storages.length-1)}function getObjectById(e,n){for(var t=0;t<n.length;t++)if(n[t].numId==e)return t;return console.log("Shouldn't reach here!"),null}function attachVariable(e,n){var t=document.getElementById(e);if("type"===e)for(var a=Object.keys(pricelist),s=0;s<a.length;s++){var o=a[s].replace("CP-COMPUTEENGINE-VMIMAGE-","");if(a[s]!==o&&null==a[s].match("PREEMPTIBLE"))(c=document.createElement("option")).text=o+" vCPUs: "+pricelist["CP-COMPUTEENGINE-VMIMAGE-"+o].cores+" RAM: "+pricelist["CP-COMPUTEENGINE-VMIMAGE-"+o].memory,c.value=o,t.add(c)}else if("GPUType"===e){var c;(c=document.createElement("option")).text=c.value="NVIDIA_TESLA_K80",t.add(c),(c=document.createElement("option")).text=c.value="NVIDIA_TESLA_P100",t.add(c)}null!=t&&(t.value=n[e],t.onchange=function(){n[e]=this.value})}function openPopup(e){for(var n in e)e.hasOwnProperty(n)&&attachVariable(n,e)}function addHTML(e,n,t,a,s){var o="<div id='"+t+"_"+a+"' class='icons'><img src='images/"+t+".png'><p>"+n+"</p> <a href='#' onclick='removeIcon(\""+t+'", "'+a+'", "'+s+"\");'><span class='glyphicon glyphicon-trash'></span></a><a href='#' data-toggle='modal' data-target='#"+t+"Settings'\tonclick='showSettings(\""+t+'", '+a+");'> <span class='glyphicon glyphicon-wrench'></span> </a></div>";$("#items").append(o)}function changeHTML(e,n,t,a){var s=n[e];$("#"+t+"_"+a+" p").text(s.nrInstances)}function changeImage(e,n,t,a){var s=e+"_"+a;document.getElementById(s).getElementsByTagName("img")[0].src=t}function checkIcon(e,n,t){1<e[t].nrInstances&&changeImage(n,t,"images/multiple"+n+".png",e[t].numId)}function incrementNrInstances(e,n,t){var a=t[e];a.nrInstances=a.nrInstances+n}function allowDrop(e){e.preventDefault()}function dragDatabase(e){jQuery.event.props.push("dataTransfer");var n=createBasicDatabase(parseInt(DBSize.innerHTML)),t=JSON.stringify(n);e.dataTransfer.setData("foo",t)}function dragStorage(e){jQuery.event.props.push("dataTransfer");var n=createBasicStorage(parseInt(storageSize.innerHTML)),t=JSON.stringify(n);e.dataTransfer.setData("foo",t)}function dragVM(e){jQuery.event.props.push("dataTransfer");var n=createBasicVirtualMachine(parseInt(nrInstances.innerHTML),parseInt(days.innerHTML),parseInt(hours.innerHTML)),t=JSON.stringify(n);e.dataTransfer.setData("foo",t)}function drop(e){e.preventDefault();var n=JSON.parse(e.dataTransfer.getData("foo"));if("VirtualMachine"===n.objectName){var t=Object.assign(new VirtualMachine,n);console.log(t),console.log(new VirtualMachine),addVirtualMachine(t)}if("Database"===n.objectName){t=Object.assign(new Database,n);console.log(t),console.log(new Database),addDatabase(t)}if("Storage"===n.objectName){t=Object.assign(new Storage,n);console.log(t),addStorage(t)}}function refresh(){for(var e in clearBox("items"),VirtualMachines){VirtualMachines[e];$("#items").append($('<div class="test"></div>').html('<img src="images/VM.png">')),console.log(e.hours)}}function clearBox(e){document.getElementById(e).innerHTML="",Databases=[],Storages=[],VirtualMachines=[]}function removeIcon(e,n){$("#"+e+"_"+n).remove(),console.log(e),"vm"!=e?"db"!=e?"cs"!=e?console.log("NO THANKS"):Storages.splice(getObjectById(n,Storages),1):Databases.splice(getObjectById(n,Databases),1):VirtualMachines.splice(getObjectById(n,VirtualMachines),1)}function showCaculationDiv(){var e=document.getElementById("canvas-pop-up");(e.style.display="none")&&(e.style.display="block")}function addCalculationToDiv(e,n){var t=new Date,a='<a  class="list-group-item list-group-item-action flex-column align-items-start"><div class="d-flex w-100 justify-content-between"><h5 class="mb-1">';a+='<h5 class="mb-1">Calculation for '+service+"</h5>",a+="<small>"+t.toTimeString()+"</small></div>",a+='<p class="mb-1">'+e+"</p>",a+="<small>Totalprice: "+n+"</small></a>";document.getElementById("canvas-pop-up").children[0].innerHTML+=a}function calculate(){console.log("Querying cloudwatch for data from "+service);var n="";$.ajax({type:"POST",url:"/cloudwatch",contentType:"application/json",data:JSON.stringify({service:service}),success:function(e){n+=e}}).done(function(){console.log("Finished processing response of AJAX request to cloudwatch "),console.log(JSON.stringify("/google.json"));addCalculationToDiv(n.substring(0,300),Math.round(0)/100),showCaculationDiv()})}function calculateTemp(){var t=new XMLHttpRequest;t.overrideMimeType("application/json"),t.open("GET","google.json",!0),t.onreadystatechange=function(){if(4==t.readyState&&"200"==t.status){var e=JSON.parse(t.responseText);for(var n in pricelist=e.gcp_price_list,VirtualMachines)VirtualMachines[n].instanceType=determineInstanceType(VirtualMachines[n].type),console.log(VirtualMachines[n].costMonthly());for(var n in Databases)console.log("Monthly costs: "+Databases[n].costMonthly());for(var n in Storages)console.log("Monthly costs: "+Storages[n].costMonthly())}},t.send(null);addCalculationToDiv("".substring(0,300),Math.round(0)/100),showCaculationDiv()}function scrollFunction(){20<document.body.scrollTop||20<document.documentElement.scrollTop?document.getElementById("top").style.display="block":document.getElementById("top").style.display="none"}function topFunction(){document.body.scrollTop=0,document.documentElement.scrollTop=0}function showSettings(e,n){"vm"!=e?"db"!=e?"cs"!=e?console.log("no reach here bitte"):openPopup(Storages[getObjectById(n,Storages)]):openPopup(Databases[getObjectById(n,Databases)]):openPopup(VirtualMachines[getObjectById(n,VirtualMachines)])}function closeSettings(e){document.getElementById(e).style.display="none"}$(function(){$("#myAccordion").accordion();var e=document.getElementById("VMInstancesSliderID");(nrInstances=document.getElementById("VMInstances")).innerHTML=e.value,e.oninput=function(){nrInstances.innerHTML=this.value};var n=document.getElementById("VMDaysSliderID");(days=document.getElementById("VMDays")).innerHTML=n.value,n.oninput=function(){days.innerHTML=this.value};var t=document.getElementById("VMHoursSliderID");(hours=document.getElementById("VMHours")).innerHTML=t.value,t.oninput=function(){hours.innerHTML=this.value};var a=document.getElementById("StorageGBSliderID");(storageSize=document.getElementById("StorageGB")).innerHTML=a.value,a.oninput=function(){storageSize.innerHTML=this.value,console.log(storageSize)};var s=document.getElementById("DBGBSliderID");(DBSize=document.getElementById("DBGB")).innerHTML=s.value,s.oninput=function(){DBSize.innerHTML=this.value};var o=document.getElementById("myModal"),c=document.getElementById("provider"),i=document.getElementById("save-modal"),r=document.getElementsByClassName("close")[0];c.onclick=function(){o.style.display="block"},i.onclick=function(){$("input:checked").parent().each(function(){service=this.innerText}),o.style.display="none"},r.onclick=function(){o.style.display="none"},window.onclick=function(e){e.target==o&&($("input:checked").parent().each(function(){service=this.innerText}),o.style.display="none")}}),window.onscroll=function(){scrollFunction()};